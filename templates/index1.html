<html>

<head>

	<!-- seo related -->
	<title>Mayabati - The Personal Chef</title>

	<!-- meta related -->
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<!-- vendor css & style files -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Josefin+Sans:300|Open+Sans:300|Oxygen|Material+Icons"
		rel="stylesheet">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

	<!-- custom css -->
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='main.css')}}"">

</head>

<body>

	<div class="container">

		<div class="row padded_row">

			<!-- right side content -->
			<div class="col-md-7">

				<div class="chat_window">

                    <div class="top_menu">
						<div class="user_info">
							<div class="logo_and_name">
							  <div class="img_cont">
								<img src="https://cdn.leonardo.ai/users/5e0f042e-ecf8-40b4-b267-d22a266ffa23/generations/8489dd4d-4996-4248-a86e-5498af5af5ac/DreamShaper_v7_Mayabati_as_a_chef_in_kitchen_cooking_food_0.jpg" class="user_img">
								<span class="online_icon"></span>
							  </div>
							  <div class="user_name">
								<h4 style="font-size: 24px; font-family: 'Cascadia'; color: rgb(0, 0, 0);"><b>Mayabati - <span style="font-size: 16px; font-family: 'Cascadia'; color: rgb(0, 0, 0);"><b>Your Personal Chef</b></span></b></h4>
							  </div>
							</div>
						  </div>
						  </div>
			

						  

					<!-- dynamically rendered -->
					<div class="messages">


					</div>

					<!-- input -->
					<div class="bottom_wrapper">
						
						<input id="msg_input" placeholder="Say Hi to begin chat..." autocomplete="off" required="" oninput="toggleSendButton(this)" onkeydown="handleKeyPress(event)" />
				
					</div>

					
				</div>

			</div>

			<!-- left side content -->
			<div class="col-md-5">
				<div class="chat_window_one">

					<div class="top_menu">
						<div class="title">Help</div>
					</div>

					<!-- help container -->
					<div class="panel-group" id="accordion">

						<!-- help - 1 -->
						<div class="panel panel-default">
							<div class="panel-heading">
								<h4 class="panel-title">
									<a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion"
										href="#collapse1">Lorem ipsum</a>
								</h4>
							</div>
							<div id="collapse1" class="panel-collapse collapse in">
								<div class="panel-body">
                            <ul>
								
                            <li><b>India first Food Processing Chatbot.</b></li>
							<li><b>Purely Made from Scratch.</b></li>
							<li><b>Model last Updated on 29 September, 2023</b></li>
							<li><b>Made By FOODING @ Proprietary Licenses</b></li>
							
								</ul>
							</div>
							</div>
							
						</div>

					</div>

				</div>
			</div>

		</div>

	</div>

	<!-- vendor script files -->
	<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js">
	</script>

<script>
/**
 * Get input from user and show it on screen on button click or Enter key press.
 */
 function getUserInputAndSendMessage() {
  const userMessageInput = document.getElementById('msg_input');
  const userMessage = userMessageInput.value;

  if (userMessage.trim() === '') {
    return; // Don't send an empty message
  }

  // Show the user message on the right side of the chat window
  showUserMessage(userMessage);

// Send the user's message to the server for processing (your existing code)
fetch('/api/chat', {
  method: 'POST',
  body: JSON.stringify({ message: userMessage }),
  headers: { 'Content-Type': 'application/json' },
})
  .then((response) => response.json())
  .then((data) => {
    const botResponse = data.message;

    if (Array.isArray(botResponse)) {
      displayBotResponseSequentially(botResponse);
    } else {
      // Show the bot's response on the left side of the chat window
      showBotMessage(botResponse);
    }

    // Clear the input field after sending the message
    userMessageInput.value = '';
  });

}

// ...

function handleKeyPress(event) {
  if (event.key === 'Enter' || event.keyCode === 13) {
    event.preventDefault(); // Prevent the default Enter key behavior
    getUserInputAndSendMessage(); // Call the function to send the message
  }
}


function displayBotResponse(response) {
  // Your code to display the bot's response goes here
  // For example, you can append the response to the chat window
  const chatWindow = document.querySelector('.chat_window .messages');
  const messageElement = document.createElement('li');
  messageElement.textContent = response;
  chatWindow.appendChild(messageElement);
}

function displayBotResponseSequentially(responses) {
  // Iterate through the responses and display them one by one
  for (const response of responses) {
    displayBotResponse(response);
  }
}



function showBotMessage(message) {
  // Create a new message element for bot messages
  const messageElement = document.createElement('li');
  messageElement.classList.add('message', 'left'); // Add 'message' and 'left' classes

  // Set the message content
  messageElement.innerHTML = `
    <div class="avatar"></div>
    <div class="text_wrapper">
      <div class="text">${message}</div>
      <div class="timestamp">${getCurrentTimestamp().toLocaleString('en-IN', {
        month: 'short',
        day: 'numeric',
        hour: 'numeric',
        minute: 'numeric',
      })}</div>
    </div>
  `;

  // Append the message to the chat window
  const chatWindow = document.querySelector('.chat_window .messages');
  chatWindow.appendChild(messageElement);

  // Scroll to the bottom of the chat window
  chatWindow.scrollTop = chatWindow.scrollHeight;
}


/**
 * Returns the current datetime for the message creation.
 */
 function getCurrentTimestamp() {
	return new Date();
}

/**
 * Renders a message on the chat screen based on the given arguments.
 * This is called from the `showUserMessage` and `showBotMessage`.
 */
function renderMessageToScreen(args) {
	// local variables
	let displayDate = (args.time || getCurrentTimestamp()).toLocaleString('en-IN', {
		month: 'short',
		day: 'numeric',
		hour: 'numeric',
		minute: 'numeric',
	});
	let messagesContainer = $('.messages');

	// init element
	let message = $(`
	<li class="message ${args.message_side}">
		<div class="avatar"></div>
		<div class="text_wrapper">
			<div class="text">${args.text}</div>
			<div class="timestamp">${displayDate}</div>
		</div>
	</li>
	`);

	// add to parent
	messagesContainer.append(message);

	// animations
	setTimeout(function () {
		message.addClass('appeared');
	}, 0);
	messagesContainer.animate({ scrollTop: messagesContainer.prop('scrollHeight') }, 300);
}

/**
 * Displays the user message on the chat screen. This is the right side message.
 */
function showUserMessage(message, datetime) {
	renderMessageToScreen({
		text: message,
		time: datetime,
		message_side: 'right',
	});
}

/**
 * Displays the chatbot message on the chat screen. This is the left side message.
 */
function showBotMessage(message, datetime) {
	renderMessageToScreen({
		text: message,
		time: datetime,
		message_side: 'left',
	});
}

/**
 * Get input from user and show it on screen on button click.
 */
$('#send_button').on('click', function (e) {
	// get and show message and reset input
	showUserMessage($('#msg_input').val());
	$('#msg_input').val('');

	// show bot message
	setTimeout(function () {
		showBotMessage(randomstring());
	}, 300);
});


</script>	
</body>

</html>